(function(d){d.fn.pin=function(b){var k=0,l=[],n=!1,m=d(window);b=b||{};var c=function(){for(var g=0,e=l.length;g<e;g++){var a=l[g];if(b.minWidth&&m.width()<=b.minWidth)a.parent().is(".pin-wrapper")&&a.unwrap(),a.css({width:"",left:"",top:"",position:""}),n=!0;else{n=!1;var f=b.containerSelector?a.closest(b.containerSelector):d(document.body),k=a.offset(),h=f.offset(),c=a.offsetParent().offset();a.parent().is(".pin-wrapper")||a.wrap("<div class='pin-wrapper'>");a.data("pin",{from:b.containerSelector?
h.top:k.top,to:h.top+f.height()-a.outerHeight(),end:h.top+f.height(),parentTop:c.top});a.css({width:a.parent().outerWidth()});a.parent().css("height",a.outerHeight())}}},p=function(){if(!n){k=m.scrollTop();for(var g=0,e=l.length;g<e;g++){var a=d(l[g]),f=a.data("pin"),c=f.from-b.padding.top,h=f.to-b.padding.top;c+a.outerHeight()>f.end?a.css("position",""):c<k&&h>k?"fixed"!=a.css("position")&&a.css({left:a.offset().left,top:0+b.padding.top}).css("position","fixed"):k>=h?a.css({left:"auto",top:h-f.parentTop}).css("position",
"absolute"):a.css({position:"",top:"",left:""})}}},q=function(){c();p()};this.each(function(){var b=d(this),e=d(this).data("pin")||{};e&&e.update||(l.push(b),d("img",this).one("load",c),e.update=q,d(this).data("pin",e))});m.scroll(p);m.resize(function(){c()});c();m.load(q);return this}})(jQuery);